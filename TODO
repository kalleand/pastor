See how tmpfile works, maybe replace this with only memory solution?

Change algoritm that is used.
